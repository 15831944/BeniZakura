=================================================
 紅桜エディタ
=================================================

はじめに
========

MS-DOS 時代、MIFES や VZ と共に一世を風靡した RED2 というエディタがありました。この、RED2 ライクな操作性を
サクラエディタ(Sakura Editor)で実現するために派生させたものが「紅桜」です。（RED SAKURA で「紅桜」です。）

RED2 の多くの機能は、サクラエディタの機能で実現可能ですので、キーバインドやメニューデフォルトの変更が主ですが、
一部、機能拡張も行なっています。


変更点
=======================================

2014.03.01 - Ver.2014.03.01.15
------------------------------------------------------------------

* C/C++ プリプロセッサコメント (#if 1 ～ #else ～ #endif) のカラーリングに対応
    #if 1 ～ #else ～ #endif 中の #else ～ #endif 部分をプリプロセッサコメントと判定してカラーリングを行うように変更。
    ただし、プリプロセッサのネストは未対応です。

* カラーリング処理の速度改善
    「Rev.ba0bb4663620 C/C++ プリプロセッサコメント（#if 0）のコメントネスト対応」以降、暫定実装であったカラーリングの
    終了判定を見なおして、編集時の動作速度を改善。

* 「各種モードの取り消し」機能の実行時に「検索マークの切り替え（クリア）」も行うように変更
    ESC キー押下時に、検索結果のハイライト表示をクリアするため。

* キーバインドのデフォルトを変更
    * Shift + Ctrl + A : TortoiseHg annotate 起動

* About ダイアログ
    - サクラエディタのバージョン表記、コピーライトの年を修正
    - ビルドに使用した Visual Sutdio のバージョン表記を追加

* Build: Windows XP 向けのバイナリ生成用に VC2008 のプロジェクトファイルを更新


2014.02.01 - Ver.2014.02.01.14
------------------------------------------------------------------

* TortoiseHg の annotate ウィンドウを起動する機能を追加
    キー割り当ての「その他」種別に、「TortoiseHg annotate 起動」機能を追加。
    この機能は、外部コマンド実行で "thg.exe annotate $F --line $y" を指定した場合と同じ動作を行います。
    TortoiseHg Ver.2.10 以降のバージョンを使用してください。(Ver.2.10.2 で動作を確認しています。）

* サクラエディタ Ver.2.1.1.0 - SVN Rev.3593 までの不具合修正を一部適用
    容易にマージ可能だったものに関して、いくつか適用しています。影響がありそうな修正は、以下の通りです。
        - SVN Rev.3283: タブバーの「閉じるボタン」が ON の場合に、タブバーのフォント指定が効かない
        - SVN Rev.3528: カーソル形状が MS-DOS 風の場合に、挿入/上書きを切り替えるとカーソル表示がおかしくなる
        - SVN Rev.3545: タブを閉じた後、直前にアクティブだったタブを表示するように変更


2014.01.01 - Ver.2014.01.01.13
------------------------------------------------------------------

* ビルド環境を「Visual C++ 2008 Express」から 「Visual Studio Express 2013 for Windows Desktop」に変更
    プラットフォーム ツールセットは v120 を使用しているため、このバージョン以降の紅桜は Windows Vista 
    以降の OS でのみ動作します。（Windows XP では動作しません。）

* アプリケーションにマニフェストを埋め込むように変更
    マニフェストファイルがない状態でも、Windows XP 以降の UI スタイルになるように。

* ビルドオプションを「サイズ優先」から「速度優先」に変更


2013.11.01 - Ver.2013.11.01.12
------------------------------------------------------------------

* ダイレクトタグジャンプ: ファイル名によるタグジャンプに対応
    タグファイル生成時に「ファイル先頭行のエントリ」を出力するように変更。
    (ctags のオプションに "--extra=+f" を追加)
    「ダイレクトタグジャンプ」ダイアログの「種類」に file を追加。

* 共通設定: タグファイル作成時の「サブフォルダも対象にする」チェックボックスのデフォルトを有効に変更

* 共通設定: タブバー「閉じるボタン」のデフォルトを有効に変更


2013.08.01 - Ver.2013.08.01.11
------------------------------------------------------------------

* キーバインドのデフォルトを変更
    * F12 : ブックマークの一覧
    * Ctrl + PgDn : 次のウィンドウ
    * Ctrl + PgUp : 前のウィンドウ
    * Alt + N : 次のウィンドウ
    * Alt + P : 前のウィンドウ
    * Shift + Ctrl + C : ファイルの最後に移動
    * Shift + Ctrl + R : ファイルの先頭に移動
    * Shift + Ctrl + T : 行末まで削除(改行単位)
    * Shift + Ctrl + V : 行頭まで削除(改行単位)

    RED2 の Ctrl キーのうち、割り当てできていなかった機能を Shift + Ctrl に割り当てました。

* 表示色のデフォルトを変更
    URL: Blue -> Deep Periwinkle に変更。
        黒地の青は見づらかったので、薄い青に変更しました。

* アプリケーションのアイコンを変更
    アプリケーションのアイコンを Windows Vista Generic Document ベースのアイコンに変更しました。
    （Windows8 では関連付けしたファイルがすべてアプリケーションのアイコンになってしまうため、
    紅桜の情けないアイコンが大量に表示されていました。）
    ついでに Grep ウィンドウのアイコンも Vista のアイコンに変更しました。

* サクラエディタ SVN Rev.3115 までの変更を反映
    サクラエディタ Ver.2.1.0.0 - SVN Rev.3241 までのチェンジセットのうち、容易にマージ可能だったものに関しては、
    いくつか適用しています。
    未反映のチャンジセットに関しては 0.0.0.9 と同様です。


2013.07.01 - Ver.2013.07.01.10
------------------------------------------------------------------

* タグファイル作成 ダイアログ: タグ作成ファルダの初期値に VCS リポジトリルートを設定するように変更

* タグファイル作成 ダイアログ: "C/C++ prototype, external and forward declarations を追加" チェックボックスを追加
    チェックボックスを ON にすると、C 言語のプロトタイプ宣言、外部宣言、前置宣言もタグに追加されます。
    (ctags のオプションに "--c-kinds=+px" を追加)

* サクラエディタ Ver.2.0.8.1 - SVN Rev.3019 までの変更を反映
    未反映のチャンジセットに関しては 0.0.0.9 と同様です。


2013.06.01 - Ver 0.0.0.9
------------------------------------------------------------------

* Grep 時にバイナリファイルを除外するように変更
    ファイルの先頭から 1KB に 0x00 (1byte) が含まれていた場合には、バイナリファイルと判断して Grep の対象から除外する。
        制限事項: この判定方法では UTF16 形式のファイルがバイナリファイルとして判断され、除外されてしまう。

* C/C++ 強調キーワードを追加
    * 不足していたキーワードや、よく使うキーワードを追加
    * 定数キーワードを別グループで登録

    サクラエディタ SVN Rev.2999 の代わりに、個人的に使用するキーワードを追加しました。

* タイプ別設定: アセンブラ: GNU Assembler 対応
    * Assembler ファイルの拡張子に ".s" を追加
    * GNU Assembler、C/C++互換プリプロセッサのキーワードを追加して、カラーリングを有効に

* リポジトリ clone 直後の状態でビルドできない不具合を修正
    svnrev.h が存在しない場合にビルドに失敗していたため、参照しないよう修正しました。

* サクラエディタ SVN Rev.3009 までの変更を反映
    未反映チャンジセットの増分は以下の通りです。
        - SVN Rev.2868: 「TAB矢印表示の仕様変更」と「TAB矢印の太字が反映されない」不具合の修正
        - SVN Rev.2999: Imp: C/C++キーワード更新


2013.05.01 - Ver 0.0.0.8
------------------------------------------------------------------

* Grep 時に ".bzr", ".git", ".hg", ".svn" フォルダを除外するように変更

* Grep 時に VCS リポジトリルートを検索対象ファルダの初期値に設定する機能を追加
    Grep ダイアログの「フォルダの初期値をカレントフォルダにする」がチェックされている場合に、
    編集中のファイルが格納されたディレクトリを起点に、親ディレクトリ方向に ".bzr", ".git", ".hg", ".svn"
    ディレクトリを検索して、これらのディレクトリが発見されたフォルダを、検索対象の初期値として設定する機能を追加。
    VCS リポジトリが発見できなかった場合には、今までどおり、編集中のファイルが格納されたディレクトリを設定する。

* C/C++ プリプロセッサコメント（#if 0）の判定において、同一行内で完結しているコメントアウト部分は無視するように変更
    以下のように、コメント内に #if 0 が記述されている場合には無視できるように対応。

    ::

        #if 0
            #if 0
                #if 0
                #endif /* #if 0 */
            #endif // #if 0
        #endif

* #1: 「キー割り当て」のインポートを行うと暴走してしまう 不具合を修正
    サクラエディタの以下の変更によるデグレード。
        - Rev.4d6bb991fa10 Keep: CShareData_IOクラス変更(CommonSetting_KeiBind関連)
    サクラエディタ Ver.2.0.7.1 の方では修正されているようなので、紅桜で取り込めていない
    以下の変更で修正されていたものと思われる。
        - SVN Rev.2505: Fix: 古いキー割り当て設定をImportすると誤動作する
        - SVN Rev.2511: Imp: キーコードからコマンドを検索する時のループを除去
        - SVN Rev.2530: Fix: Importしたキーの名前が内部のバッファサイズより長いとメモリ破壊する
    紅桜のキー定義ファイルはサクラエディタと互換性がない（キー定義数が異なる）ため、
    キー定義数の異なるファイルはインポートできないように変更した。
    付随して、旧形式（？）のキー定義ファイルのインポート処理も削除した。

* 共通設定: GREP フォルダの初期値をカレントフォルダにする: 有効に変更

* 共通設定: カーソル位置の文字列をデフォルトの検索文字列にする: 無効に変更

* タイプ別設定: 「入力補完 強調キーワード」のデフォルトを有効に変更

* 「タグジャンプ」ダイアログの縦幅を拡張
    ダイアログのリサイズ対応（サクラエディタ Rev.2754）により、ウィンドウのスタイルが変更になった影響で
    「サイズ変更グリップ」と「キャンセルボタン」が重なって描画されていたため。

* About ダイアログ: バージョン表示に「Mercurial タグ + 相対リビジョン」を使用するように変更

* サクラエディタ Ver.2.0.7.1 - SVN Rev.2836 までの変更を反映
    未反映のチャンジセットに関しては 0.0.0.7 と同様です。


2013.04.01 - Ver 0.0.0.7
------------------------------------------------------------------

* サクラエディタ Ver.2.0.6.0 - SVN Rev.2743 までの変更を反映
    未反映チャンジセットの増分は以下の通りです。
        SVN Rev.2643: Keep: Windows2000以降サポート
            紅桜は WindowsXP 以降をサポートのため。


2013.03.01 - Ver 0.0.0.6
------------------------------------------------------------------

* サクラエディタ SVN Rev.2614 までの変更を反映
    未反映のチャンジセットに関しては 0.0.0.4 と同様です。


2013.02.15 - Ver 0.0.0.5
------------------------------------------------------------------

* サクラエディタ SVN Rev.2563 までの変更を反映
    SVN Rev.2544: 「強調キーワードによる補完機能」を使用したかったため更新しました。
    未反映のチャンジセットに関しては 0.0.0.4 と同様です。


2013.02.01 - Ver 0.0.0.4
------------------------------------------------------------------

* C/C++ プリプロセッサによるコメントのネスト対応にて #ifndef の判定が漏れていた不具合を修正

* サクラエディタ SVN Rev.2535 までの変更を反映
    ただし、以下の変更に関しては、変更が衝突していたため未反映です。
        * SVN Rev.2505: Fix: 古いキー割り当て設定をImportすると誤動作する
        * SVN Rev.2511: Imp: キーコードからコマンドを検索する時のループを除去
        * SVN Rev.2530: Fix: Importしたキーの名前が内部のバッファサイズより長いとメモリ破壊する


2013.01.01 - Ver 0.0.0.3
------------------------------------------------------------------

* アプリケーションのアイコンを変更

* C/C++ プリプロセッサによるコメントのネスト対応
    #if 0 ～ #endif がネストした状態でも正しくカラーリングできるよう改良。
    ただし、暫定実装の部分が残っているため、カラーリング処理の速度は低下しているはずです。

* タイプ別設定: 「行の間隔」のデフォルトを 1 -> 0 に変更

* １行の最大桁数を 10240 -> 1024 に変更

* サクラエディタ SVN Rev.2513 までの変更を反映
    ただし、以下の変更に関しては、変更が衝突していたため未反映です。
        * SVN Rev.2505: Fix: 古いキー割り当て設定をImportすると誤動作する
        * SVN Rev.2511: Imp: キーコードからコマンドを検索する時のループを除去


2012.12.01 - Ver 0.0.0.2
------------------------------------------------------------------

* ルーラーを 8 文字単位で表示するように変更

* 検索 ダイアログ:「見つからないときにメッセージを表示」チェックボックスを削除

* ジャンプ ダイアログ: PL/SQL 関連の機能を削除

* バージョン情報 ダイアログ: コントロールの配置を調整

* 検索や GREP 時の「英大文字と小文字を区別する」のデフォルトを「有効」に変更

* 共通設定: 「ファイルの排他制御」のデフォルト値を「上書きを禁止する」から「しない」に変更

* 共通設定: GREP 結果のリアルタイム表示を「有効」に変更

* 共通設定: ウィンドウ非アクティブ時のタイトルバー表示を、ウィンドウアクティブ時と同一に

* タイプ別設定: C/C++, Java のスマートインデントのデフォルトを「無効」に変更

* デフォルトの表示色を RED2 ライクな配色に変更
    * ルーラーの背景色をグリーンに
    * TAB を暗いブルーに
    * 改行記号をイエローに
    * 行番号をグレーに

* サクラエディタ SVN Rev.2498 までの変更を反映


2012.11.01 - Ver 0.0.0.1 (サクラエディタ Ver.2.0.5.0 からの変更点)
------------------------------------------------------------------

* 背景色のデフォルトを「黒地」ベースに変更

* キーバインドのデフォルトを RED2 ライクなバインドに変更

    ただし、Windows 標準機能に関する CTRL + Z, X, C, V など、サクラエディタのキーバインドを継承している部分も多いです。
    参考までに、RED2 とキーバインドが異なる CTRL キーのバインドは以下のとおりです。

    ===========  ==========================  ==========================
    キー         RED2                        紅桜                      
    ===========  ==========================  ==========================
    CTRL + C     ファイルの最後にジャンプ    コピー
    CTRL + F     １語先（右）に進む          検索ダイアログ
    CTRL + G     カーソル上の文字を削除      Grep ダイアログ
    CTRL + H     カーソル直前の文字を削除    未割り当て
    CTRL + J     大文字小文字変換            指定行へジャンプ
    CTRL + M     改行入力                    ブックマーク
    CTRL + O     改行・タブ表示切替          アウトライン表示
    CTRL + R     ファイル先頭にジャンプ      置換ダイアログ
    CTRL + S     カーソル左                  上書き保存
    CTRL + V     カーソルから左の文字を削除  貼り付け
    CTRL + X     カーソル下                  切り取り
    CTRL + Z     拡張コントロールキー        元に戻す
    CTRL + E     カーソル上                  ウィンドウ一覧
    CTRL + D     カーソル右                  単語削除
    ===========  ==========================  ==========================

    ※ CTRL + I は未割り当て状態ですが、 TAB が入力されます

    RED2 の F1 ～ F4 メニューに相当する機能は、カスタムメニューで実現しています。コントロールキーのバインドされて
    いないファイル先頭へのジャンプは F2 - T, ファイル末尾へのジャンプは F2 - B で代用してください。

* 「行頭に移動(折り返し単位)」のデフォルト動作を、空白を無視して移動するように変更
    サクラエディタは「行頭に移動(折り返し単位)」でカーソルを移動する場合に、行頭のホワイトスペース位置に移動して
    いましたが、RED2 と同様、行頭に移動するように変更しました。（紅桜では SHIFT + ← にバインド）

* 「改行」機能を追加
    RED2 では CTRL + M にバインドされていた機能ですが、紅桜の CTRL + M はサクラエディタと同様「マーク」機能のままです。
    RED2 と同じキーバインドを実現したい場合に使用してください。

* 「単語取り込み」機能を追加
    実装はしたものの、デフォルトキーにはバインドされていません。

* 「現在位置～単語末尾の文字で検索」機能を追加
    RED2 で CTRL + L にバインドされていた「カーソル位置文字列を検索バッファに取り込む」機能。RED2 から機能を拡張して
    おり、検索バッファに取り込むと同時に検索を行います。RED2 と同様、連続実行することで、後続の単語を追加して
    再検索を行います。デフォルトでは ALT + L にバインド。

* 「現在位置の単語で検索」機能を追加
    上記の「現在位置～単語末尾の文字で検索」と同様の機能ですが、サクラエディタの単語取り込みと同様、カーソルより
    前方向に単語区切りを探して単語を取り込みます。連続実行することで、後続の単語を追加して再検索を行います。
    デフォルトでは CTRL + L にバインド。

* ダブルクリックに「現在位置の単語で検索」機能をバインド
    上記の機能をダブルクリックにもバインドしていますので、マウスのみで単語検索を行うことができます。

* 単語取り込み時の文字種別に「括弧」を追加
    括弧は ( ) { } [ ]  の 6 文字で、これらの括弧は常に単語の区切りとして認識されます。

* C/C++ ソース編集時に、プリプロセッサを用いたコメントアウトが正しくカラーリングできない問題に対応
    サクラエディタでは、ブロックコメントのデフォルトに #if 0 と #endif を定義して、プリプロセッサ コメントの
    カラーリングを実現していたため、途中に #else や #elif などが記述されていても、 #endif までコメントとして
    カラーリングされていました。
    対策として、 #if 0 をコメント開始、#endif、#else、#elif をコメント終了として判定を行う処理を追加して、
    カラーリングを行うように変更しています。

* 色指定に「C/C++ プリプロセッサコメント」項目を追加
    コメントとは別の色を設定可能です。デフォルト色はグレー。

* 挿入モード時の DOS タイプカーソルの高さを、半分から ÷ 2.6 に変更（少し低くした）
    半分の高さだと "-" の上にカーソルがある場合に文字があるのか無いのか、わからなくなってしまうため。

* 「検索／置換」の対象文字列が見つからなかった場合のダイアログ表示を削除
    いちいちダイアログが開くのは煩わしかったので削除しました。

* キーボードの「Pause」キーを使用可能に変更
    ノート PC など「Home」キーが存在しない機種で、代替キーとして使用できるように。デフォルトのキーバインドは「Home」
    と同様、ウィンドウの切り替えに設定されています。

* ウィンドウの「最大化」機能を追加
    WMed32 と同様、デフォルトでは F12 にバインド。

* C/C++ 強調キーワードのデフォルト定義を３種類に分割
    プリプロセッサ、データタイプを別々に定義。

* タイプ別設定のうち、個人的に使用頻度の低い設定を削除
    HTML, SQL, COBOL, AWK, DOS Batch, Pascal, TEX, Perl, VB, Rich Text を削除

* その他、各種デフォルト値の変更



ソースコード
============


ライセンス
----------
サクラエディタの最近の変更部分については「zlib/libpng ライセンス」を適用しているようですので、紅桜の変更部分も
これに倣い、「 zlib / libpng ライセンス」を適用します。


ソースコード リポジトリ
-----------------------
本家サクラエディタの Subversion リポジトリ内の trunk2 ディレクトリを HgSubversion にて Mercurial リポジトリに
変換したものをベースにしています。
ソースコード リポジトリは bitbucket にて公開しています。

    https://bitbucket.org/suzzsegv/benizakura/


ビルド方法
==========
Visual Studio Express 2013 for Windows Desktop を用いてビルドしています。sakura/BeniZakura_vs2013.sln をダブルクリックして
IDE を起動後、ターゲットとして Release_Unicode を選択、ビルドメニューからビルドを行ってください。


